<!DOCTYPE html>

<html lang="en">
<head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>使用 Session 存储数据（Storing data in Session） &mdash; Phalcon7 1.0.0 文档</title>
    <meta name="keywords" content="php, phalcon, phalcon7, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="../static/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../static/phalcon.css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="../static/jquery.min.js"></script>
    <link rel="shortcut icon" href="../static/img/favicon.ico"/>
    <link rel="index" title="索引" href="../index.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="top" title="Phalcon7 1.0.0 文档" href="../index.html" />
    <link rel="next" title="过滤与清理（Filtering and Sanitizing）" href="filter.html" />
    <link rel="prev" title="闪存消息（Flashing Messages）" href="flash.html" /> 
</head>
<body>

<header class="page-header">
<nav class="navbar" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
				<span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
			</button>
			<a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
		</div>

		<div class="collapse navbar-collapse navbar-right" id="main-menu-container">
			<ul class="nav navbar-nav main-menu">
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7" class="header-nav-link">GitHub</a></li>
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7/releases" class="header-nav-link">Download</a></li>
			  <li class="first"><a href="/api/" class="header-nav-link">API</a></li>
			</ul>
		</div>
	</div>
</nav>
</header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="filter.html" title="过滤与清理（Filtering and Sanitizing）"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="flash.html" title="闪存消息（Flashing Messages）"
             accesskey="P">上一页</a> |</li>
        <li><a href="http://myleftstudio.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon7 1.0.0 文档</a> &raquo;</li> 
      </ul>
    </div>  
</div>

<div class="container-fluid">
	<div class="col-md-3 primary-box">
		<div class="panel panel-default">
			<div class="panel-heading"><a href="../index.html">內容目录</a></div>
			<div class="panel-body"><ul>
<li><a class="reference internal" href="#">使用 Session 存储数据（Storing data in Session）</a><ul>
<li><a class="reference internal" href="#starting-the-session">启动会话（Starting the Session）</a></li>
<li><a class="reference internal" href="#storing-retrieving-data-in-session">会话数据的存储与读取（Storing/Retrieving data in Session）</a></li>
<li><a class="reference internal" href="#removing-destroying-sessions">会话数据的删除和销毁（Removing/Destroying Sessions）</a></li>
<li><a class="reference internal" href="#isolating-session-data-between-applications">隔离不同应用的会话数据（Isolating Session Data between Applications）</a></li>
<li><a class="reference internal" href="#session-bags">会话袋（Session Bags）</a></li>
<li><a class="reference internal" href="#persistent-data-in-components">组件的持久数据（Persistent Data in Components）</a></li>
<li><a class="reference internal" href="#session-adapters">会话适配器（Session Adapters）</a></li>
<li><a class="reference internal" href="#implementing-your-own-adapters">自定义适配器（Implementing your own adapters）</a></li>
</ul>
</li>
</ul>
</div>
			<div class="panel-heading">上一个主题</div>
            <div class="panel-body"><p class="topless"><a href="flash.html" title="上一章">&lt; 闪存消息（Flashing Messages）</a></p></div>
			<div class="panel-heading">下一个主题</div>
            <div class="panel-body"><p class="topless"><a href="filter.html" title="下一章">过滤与清理（Filtering and Sanitizing） &gt;</a></p></div>
		</div>
	</div>
  <div class="col-md-9 second-box" valign="top">
	<div class="document">
		<div class="documentwrapper">
		  <div class="bodywrapper">
			<div class="body" >
			  
  <div class="section" id="session-storing-data-in-session">
<h1>使用 Session 存储数据（Storing data in Session）<a class="headerlink" href="#session-storing-data-in-session" title="永久链接至标题">¶</a></h1>
<p>The <span class="xref doc">Phalcon\Session</span> provides object-oriented wrappers to access session data.</p>
<p>Reasons to use this component instead of raw-sessions:</p>
<ul class="simple">
<li>You can easily isolate session data across applications on the same domain</li>
<li>Intercept where session data is set/get in your application</li>
<li>Change the session adapter according to the application needs</li>
</ul>
<div class="section" id="starting-the-session">
<h2>启动会话（Starting the Session）<a class="headerlink" href="#starting-the-session" title="永久链接至标题">¶</a></h2>
<p>Some applications are session-intensive, almost any action that performs requires access to session data. There are others who access session data casually.
Thanks to the service container, we can ensure that the session is accessed only when it&#8217;s clearly needed:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Session\Adapter\Files</span> <span class="k">as</span> <span class="nx">Session</span><span class="p">;</span>

<span class="c1">// Start the session the first time when some component request the session service</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">setShared</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nv">$session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Session</span><span class="p">();</span>
    <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>
    <span class="k">return</span> <span class="nv">$session</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="storing-retrieving-data-in-session">
<h2>会话数据的存储与读取（Storing/Retrieving data in Session）<a class="headerlink" href="#storing-retrieving-data-in-session" title="永久链接至标题">¶</a></h2>
<p>From a controller, a view or any other component that extends <a class="reference internal" href="../api/Phalcon_DI_Injectable.html"><span class="doc">Phalcon\Di\Injectable</span></a> you can access the session service
and store items and retrieve them in the following way:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Set a session variable</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s2">&quot;user-name&quot;</span><span class="p">,</span> <span class="s2">&quot;Michael&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">welcomeAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Check if the variable is defined</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s2">&quot;user-name&quot;</span><span class="p">))</span> <span class="p">{</span>

            <span class="c1">// Retrieve its value</span>
            <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;user-name&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="removing-destroying-sessions">
<h2>会话数据的删除和销毁（Removing/Destroying Sessions）<a class="headerlink" href="#removing-destroying-sessions" title="永久链接至标题">¶</a></h2>
<p>It&#8217;s also possible remove specific variables or destroy the whole session:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">removeAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Remove a session variable</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s2">&quot;user-name&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logoutAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Destroy the whole session</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">destroy</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="isolating-session-data-between-applications">
<h2>隔离不同应用的会话数据（Isolating Session Data between Applications）<a class="headerlink" href="#isolating-session-data-between-applications" title="永久链接至标题">¶</a></h2>
<p>Sometimes a user can use the same application twice, on the same server, in the same session. Surely, if we use variables in session,
we want that every application have separate session data (even though the same code and same variable names). To solve this, you can add a
prefix for every session variable created in a certain application:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Session\Adapter\Files</span> <span class="k">as</span> <span class="nx">Session</span><span class="p">;</span>

<span class="c1">// Isolating the session data</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// All variables created will prefixed with &quot;my-app-1&quot;</span>
    <span class="nv">$session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Session</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;uniqueId&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my-app-1&#39;</span>
        <span class="p">)</span>
    <span class="p">);</span>

    <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$session</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Adding a unique ID is not necessary.</p>
</div>
<div class="section" id="session-bags">
<h2>会话袋（Session Bags）<a class="headerlink" href="#session-bags" title="永久链接至标题">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Session_Bag.html"><span class="doc">Phalcon\Session\Bag</span></a> is a component that helps separating session data into &#8220;namespaces&#8221;.
Working by this way you can easily create groups of session variables into the application. By only setting the variables in the &#8220;bag&#8221;,
it&#8217;s automatically stored in session:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Session\Bag</span> <span class="k">as</span> <span class="nx">SessionBag</span><span class="p">;</span>

<span class="nv">$user</span>       <span class="o">=</span> <span class="k">new</span> <span class="nx">SessionBag</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setDI</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Kimbra Johnson&quot;</span><span class="p">;</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">age</span>  <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="persistent-data-in-components">
<h2>组件的持久数据（Persistent Data in Components）<a class="headerlink" href="#persistent-data-in-components" title="永久链接至标题">¶</a></h2>
<p>Controller, components and classes that extends <a class="reference internal" href="../api/Phalcon_DI_Injectable.html"><span class="doc">Phalcon\Di\Injectable</span></a> may inject
a <a class="reference internal" href="../api/Phalcon_Session_Bag.html"><span class="doc">Phalcon\Session\Bag</span></a>. This class isolates variables for every class.
Thanks to this you can persist data between requests in every class in an independent way.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Create a persistent variable &quot;name&quot;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Laura&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">welcomeAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;Welcome, &quot;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In a component:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Security</span> <span class="k">extends</span> <span class="nx">Component</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">auth</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Create a persistent variable &quot;name&quot;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Laura&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistent</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The data added to the session (<code class="code docutils literal"><span class="pre">$this-&gt;session</span></code>) are available throughout the application, while persistent (<code class="code docutils literal"><span class="pre">$this-&gt;persistent</span></code>)
can only be accessed in the scope of the current class.</p>
</div>
<div class="section" id="session-adapters">
<h2>会话适配器（Session Adapters）<a class="headerlink" href="#session-adapters" title="永久链接至标题">¶</a></h2>
<p>这些适配器封装特定的数据存储方式的详细操作，下面是我们支持的数据存储方式：</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="49%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">名称</th>
<th class="head">描述</th>
<th class="head">API</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Files</td>
<td>将会话数据存储在文本文件</td>
<td><a class="reference internal" href="../api/Phalcon_Session_Adapter_Files.html"><span class="doc">Phalcon\Session\Adapter\Files</span></a></td>
</tr>
<tr class="row-odd"><td>Libmemcached</td>
<td>利用Memcached扩展，将会话数据存储在 Memcached</td>
<td><a class="reference internal" href="../api/Phalcon_Session_Adapter_Libmemcached.html"><span class="doc">Phalcon\Session\Adapter\Libmemcached</span></a></td>
</tr>
<tr class="row-even"><td>Memcache</td>
<td>利用Memcache扩展，将会话数据存储在 Memcached</td>
<td><a class="reference internal" href="../api/Phalcon_Session_Adapter_Memcache.html"><span class="doc">Phalcon\Session\Adapter\Memcache</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implementing-your-own-adapters">
<h2>自定义适配器（Implementing your own adapters）<a class="headerlink" href="#implementing-your-own-adapters" title="永久链接至标题">¶</a></h2>
<p>The <a class="reference internal" href="../api/Phalcon_Session_AdapterInterface.html"><span class="doc">Phalcon\Session\AdapterInterface</span></a> interface must be implemented in order to create your own session adapters or extend the existing ones.</p>
<p>There are more adapters available for this components in the <a class="reference external" href="https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Session/Adapter">Phalcon Incubator</a></p>
</div>
</div>


			</div>
		  </div>
		</div>
	</div>
  </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="filter.html" title="过滤与清理（Filtering and Sanitizing）"
             >下一页</a> |</li>
        <li class="right" >
          <a href="flash.html" title="闪存消息（Flashing Messages）"
             >上一页</a> |</li> 
      </ul>
    </div>

<footer class="footer">
	<div class="container">
      <div class="row">
          <div class="col-xs-6 col-sm-3">
              <h4>Download</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/releases">安裝 Phalcon7</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-3">
              <h4>Community</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7">GitHub</a></li>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/issues">Issue Tracker</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-2">
              <h4>About</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon/wiki/%E6%8D%90%E8%B5%A0%EF%BC%88Donation%EF%BC%89">Donate</a></li>
              </ul>
          </div>
          <div id="license-spaccer" class="visible-xs"></div>
          <div id="license-wrapper" class="col-xs-12 col-sm-4">
              <p class="license">

                  Phalcon7 Framework is released under the <a href="https://github.com/dreamsxin/cphalcon7/blob/master/docs/LICENSE.md">new BSD license</a>.<br>
                  Except where otherwise noted, content on this site is licensed under the
                  <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a>
              </p>
              <div class="design">
                  <span>Designed by:</span>

                  <a href="http://www.fog-city.net/" class="fogcity" target="_blank" title="Fog City Software"><span>Fog City Software</span></a>
              </div>
          </div>
      </div>
	</div>
</footer>
</body>
</html>