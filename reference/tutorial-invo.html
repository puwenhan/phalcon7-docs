<!DOCTYPE html>

<html lang="en">
<head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>教程：INVO 简介（Tutorial: Introducing INVO） &mdash; Phalcon7 1.0.0 文档</title>
    <meta name="keywords" content="php, phalcon, phalcon7, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="../static/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../static/phalcon.css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="../static/jquery.min.js"></script>
    <link rel="shortcut icon" href="../static/img/favicon.ico"/>
    <link rel="index" title="索引" href="../index.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="top" title="Phalcon7 1.0.0 文档" href="../index.html" />
    <link rel="next" title="教程: 保护INVO（Tutorial: Securing INVO）" href="tutorial-invo-2.html" />
    <link rel="prev" title="教程：让我们通过例子来学习（Tutorial: Let’s learn by example）" href="tutorial.html" /> 
</head>
<body>

<header class="page-header">
<nav class="navbar" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
				<span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
			</button>
			<a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
		</div>

		<div class="collapse navbar-collapse navbar-right" id="main-menu-container">
			<ul class="nav navbar-nav main-menu">
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7" class="header-nav-link">GitHub</a></li>
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7/releases" class="header-nav-link">Download</a></li>
			  <li class="first"><a href="/api/" class="header-nav-link">API</a></li>
			</ul>
		</div>
	</div>
</nav>
</header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="tutorial-invo-2.html" title="教程: 保护INVO（Tutorial: Securing INVO）"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="教程：让我们通过例子来学习（Tutorial: Let’s learn by example）"
             accesskey="P">上一页</a> |</li>
        <li><a href="http://myleftstudio.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon7 1.0.0 文档</a> &raquo;</li> 
      </ul>
    </div>  
</div>

<div class="container-fluid">
	<div class="col-md-3 primary-box">
		<div class="panel panel-default">
			<div class="panel-heading"><a href="../index.html">內容目录</a></div>
			<div class="panel-body"><ul>
<li><a class="reference internal" href="#">教程：INVO 简介（Tutorial: Introducing INVO）</a><ul>
<li><a class="reference internal" href="#project-structure">项目结构（Project Structure）</a></li>
<li><a class="reference internal" href="#routing">路由（Routing）</a></li>
<li><a class="reference internal" href="#configuration">配置（Configuration）</a></li>
<li><a class="reference internal" href="#autoloaders">自动加载器（Autoloaders）</a></li>
<li><a class="reference internal" href="#registering-services">注册服务（Registering services）</a></li>
<li><a class="reference internal" href="#handling-the-request">处理请求（Handling the Request）</a></li>
<li><a class="reference internal" href="#dependency-injection">依赖注入（Dependency Injection）</a></li>
</ul>
</li>
</ul>
</div>
			<div class="panel-heading">上一个主题</div>
            <div class="panel-body"><p class="topless"><a href="tutorial.html" title="上一章">&lt; 教程：让我们通过例子来学习（Tutorial: Let&#8217;s learn by example）</a></p></div>
			<div class="panel-heading">下一个主题</div>
            <div class="panel-body"><p class="topless"><a href="tutorial-invo-2.html" title="下一章">教程: 保护INVO（Tutorial: Securing INVO） &gt;</a></p></div>
		</div>
	</div>
  <div class="col-md-9 second-box" valign="top">
	<div class="document">
		<div class="documentwrapper">
		  <div class="bodywrapper">
			<div class="body" >
			  
  <div class="section" id="invo-tutorial-introducing-invo">
<h1>教程：INVO 简介（Tutorial: Introducing INVO）<a class="headerlink" href="#invo-tutorial-introducing-invo" title="永久链接至标题">¶</a></h1>
<p>在第二部分，我们将会说明一个完整的应用用来加深Phalcon的开发。
INVO是我们创建的一个程序样本。INVO是一个简单的用来允许用户生成发票的网站，并且可以做其他的任务，比如管理他们的客户或者产品。你可以从 <a class="reference external" href="https://github.com/dreamsxin/invo">Github</a> 中复制它的代码。</p>
<p>同样，INVO使用 <a class="reference external" href="http://getbootstrap.com/">Bootstrap</a> 做的前端框架。虽然这个应用不能生成发票，但是它仍然可以作为一个例子来理解框架是如何工作的。</p>
<div class="section" id="project-structure">
<h2>项目结构（Project Structure）<a class="headerlink" href="#project-structure" title="永久链接至标题">¶</a></h2>
<p>一旦你从你的文档根目录复制了这个项目，你将会看到以下结构：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>invo/
    app/
        config/
        controllers/
        forms/
        library/
        logs/
        models/
        plugins/
        views/
    cache/
    docs/
    public/
        css/
        fonts/
        js/
    schemas/
</pre></div>
</div>
<p>正如你所知道的，Phalcon不会强求应用程序使用特定的文件结构。这个项目提供了一个简单的MVC模型和公共文档根目录。</p>
<p>一旦你打开浏览器输入 <a class="reference external" href="http://localhost/invo">http://localhost/invo</a> 浏览应用程序你将会看到下面这样：</p>
<img class="align-center" src="../static/img/invo-1.png"><p>这个应用分为两部分，一部分是前端，这个是一个公开的部分，浏览者可以接收关于INVO的信息，也可以请求联系人信息。第二部分是后端，一个管理员区域，一个注册用户可以管理他/她的产品和客户。</p>
</div>
<div class="section" id="routing">
<h2>路由（Routing）<a class="headerlink" href="#routing" title="永久链接至标题">¶</a></h2>
<p>INVO使用内置的标准路由. <a class="reference internal" href="routing.html"><span class="doc">Router</span></a> 组件. 路由符合以下格式：<cite>/:controller/:action/:params</cite>. 这就意味着第一部分URI是控制器，第二部分是方法，剩余的是参数。</p>
<p>下面的路由 <cite>/session/register</cite> 执行的是 <cite>SessionController</cite> 控制器和它的 <cite>registerAction</cite> 方法。</p>
</div>
<div class="section" id="configuration">
<h2>配置（Configuration）<a class="headerlink" href="#configuration" title="永久链接至标题">¶</a></h2>
<p>INVO有一个设置应用常规参数的配置文件。这个文件位于 <cite>app/config/config.ini</cite>，并且他在应用引导文件的最开始就开始加载 (<cite>public/index.php</cite>)：</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Config\Adapter\Ini</span> <span class="k">as</span> <span class="nx">ConfigIni</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="c1">// Read the configuration</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConfigIni</span><span class="p">(</span><span class="nx">APP_PATH</span> <span class="o">.</span> <span class="s1">&#39;app/config/config.ini&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference internal" href="config.html"><span class="doc">Phalcon\Config</span></a> 允许我们使用面向对象的方式来操作文件。在这个例子中，我们使用ini文件作为配置文件，然而，它对于配置文件有更多的适配支持。这个配置文件包含以下配置：</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[database]</span>
<span class="na">host</span>     <span class="o">=</span> <span class="s">localhost</span>
<span class="na">username</span> <span class="o">=</span> <span class="s">root</span>
<span class="na">password</span> <span class="o">=</span> <span class="s">secret</span>
<span class="na">name</span>     <span class="o">=</span> <span class="s">invo</span>

<span class="k">[application]</span>
<span class="na">controllersDir</span> <span class="o">=</span> <span class="s">app/controllers/</span>
<span class="na">modelsDir</span>      <span class="o">=</span> <span class="s">app/models/</span>
<span class="na">viewsDir</span>       <span class="o">=</span> <span class="s">app/views/</span>
<span class="na">pluginsDir</span>     <span class="o">=</span> <span class="s">app/plugins/</span>
<span class="na">formsDir</span>       <span class="o">=</span> <span class="s">app/forms/</span>
<span class="na">libraryDir</span>     <span class="o">=</span> <span class="s">app/library/</span>
<span class="na">baseUri</span>        <span class="o">=</span> <span class="s">/invo/</span>
</pre></div>
</div>
<p>对于配置文件，Phalcon 没有任何提前预约好的惯例配置。通过节（Sections）帮助我们组织相应选项。在这个文件里 <cite>application</cite> 和 <cite>database</cite> 这两个部分将被用于后面的程序。</p>
</div>
<div class="section" id="autoloaders">
<h2>自动加载器（Autoloaders）<a class="headerlink" href="#autoloaders" title="永久链接至标题">¶</a></h2>
<p>在引导文件 (public/index.php) 的第二部分是自动加载器:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Auto-loader configuration</span>
<span class="sd"> */</span>
<span class="k">require</span> <span class="nx">APP_PATH</span> <span class="o">.</span> <span class="s1">&#39;app/config/loader.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>自动加载器注册一组目录列表，应用程序将根据需要从这组目录里查找需要的类文件。</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Loader</span><span class="p">();</span>

<span class="c1">// We&#39;re a registering a set of directories taken from the configuration file</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerDirs</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="nx">APP_PATH</span> <span class="o">.</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">application</span><span class="o">-&gt;</span><span class="na">controllersDir</span><span class="p">,</span>
        <span class="nx">APP_PATH</span> <span class="o">.</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">application</span><span class="o">-&gt;</span><span class="na">pluginsDir</span><span class="p">,</span>
        <span class="nx">APP_PATH</span> <span class="o">.</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">application</span><span class="o">-&gt;</span><span class="na">libraryDir</span><span class="p">,</span>
        <span class="nx">APP_PATH</span> <span class="o">.</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">application</span><span class="o">-&gt;</span><span class="na">modelsDir</span><span class="p">,</span>
        <span class="nx">APP_PATH</span> <span class="o">.</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">application</span><span class="o">-&gt;</span><span class="na">formsDir</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
</pre></div>
</div>
<p>注意, 以上代码注册的目录是在配置文件中定义的. 唯一没有注册的目录是 <cite>viewsDir</cite>, 因为它包含 <cite>HTML</cite> + <cite>PHP</cite> 文件但不是类.
同时, 也要注意我们使用了常量 <cite>APP_PATH</cite>, 这个常量在引导文件 (public/index.php) 中被定义, 允许我们对我们项目的根路径有一个参考:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// ...</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;APP_PATH&#39;</span><span class="p">,</span> <span class="nb">realpath</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="registering-services">
<h2>注册服务（Registering services）<a class="headerlink" href="#registering-services" title="永久链接至标题">¶</a></h2>
<p>服务注册已经在前面的教程中实现了, 利用一个闭包来实现惰性加载组件：</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Url</span> <span class="k">as</span> <span class="nx">UrlProvider</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="sd">/**</span>
<span class="sd"> * The URL component is used to generate all kind of URLs in the application</span>
<span class="sd"> */</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UrlProvider</span><span class="p">();</span>

    <span class="nv">$url</span><span class="o">-&gt;</span><span class="na">setBaseUri</span><span class="p">(</span><span class="nv">$config</span><span class="o">-&gt;</span><span class="na">application</span><span class="o">-&gt;</span><span class="na">baseUri</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$url</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>We will discuss this file in depth later.</p>
</div>
<div class="section" id="handling-the-request">
<h2>处理请求（Handling the Request）<a class="headerlink" href="#handling-the-request" title="永久链接至标题">¶</a></h2>
<p>如果我们忽略文件 (public/index.php) 的结束, 请求最终会被 <a class="reference internal" href="../api/Phalcon_Mvc_Application.html"><span class="doc">Phalcon\Mvc\Application</span></a> 处理, 它会初始化并执行所有必要条件，使应用程序运行：</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Application</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="dependency-injection">
<h2>依赖注入（Dependency Injection）<a class="headerlink" href="#dependency-injection" title="永久链接至标题">¶</a></h2>
<p>Phalcon 是一个高度解耦的框架，所以我们一个组件来充当胶水来让每个组件都能正常工作。这个组件就是 <span class="xref doc">Phalcon\Di</span>。这是一个服务容器，可以执行依赖注入和服务定位，实例化应用所需要的所有组件。</p>
<p>在容器中有多种注册服务的方法。在INVO里, 大部分服务使用匿名函数或者闭包来进行注册的, 对象以惰性的方式被实例化，减少了应用程序所需要的资源。</p>
<p>例如，下面摘录了 Session 服务的注册。当应用程序需要访问 Session 数据的时候，匿名函数才会被调用：</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Session\Adapter\Files</span> <span class="k">as</span> <span class="nx">Session</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="c1">// Start the session the first time a component requests the session service</span>
<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nv">$session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Session</span><span class="p">();</span>

    <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$session</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>这里，我们可以自由的更改适配器，执行额外的初始化或者其他操作。注意，这个服务器是使用 <cite>session</cite> 名字进行注册的。这是一个惯例，来允许框架在服务容器中识别正在活动的服务.</p>
<p>一个请求可以使用多个服务，单独注册每个服务可以说是一个繁重的任务。因此，框架提供了 <span class="xref doc">Phalcon\Di</span> 的一个变种，称作  <span class="xref doc">Phalcon\Di\FactoryDefault</span>，其任务是注册所有 MVC 所需要的服务来提供一个全栈框架。</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\DI\FactoryDefault</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="c1">// The FactoryDefault Dependency Injector automatically registers the</span>
<span class="c1">// right services providing a full-stack framework</span>
<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FactoryDefault</span><span class="p">();</span>
</pre></div>
</div>
<p>它注册了大部分框架提供的标准服务和组件。如果我们需要重写某些已经定义的服务，我们仅仅需要重新定义它，就像上面的 &#8220;session&#8221; 和 &#8220;url&#8221;一样，这就是变量  <code class="code docutils literal"><span class="pre">$di</span></code> 存在的原因.</p>
<p>在下一章，我们将会看到如何在INVO中实施认证和授权。</p>
</div>
</div>


			</div>
		  </div>
		</div>
	</div>
  </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="tutorial-invo-2.html" title="教程: 保护INVO（Tutorial: Securing INVO）"
             >下一页</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="教程：让我们通过例子来学习（Tutorial: Let’s learn by example）"
             >上一页</a> |</li> 
      </ul>
    </div>

<footer class="footer">
	<div class="container">
      <div class="row">
          <div class="col-xs-6 col-sm-3">
              <h4>Download</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/releases">安裝 Phalcon7</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-3">
              <h4>Community</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7">GitHub</a></li>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/issues">Issue Tracker</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-2">
              <h4>About</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon/wiki/%E6%8D%90%E8%B5%A0%EF%BC%88Donation%EF%BC%89">Donate</a></li>
              </ul>
          </div>
          <div id="license-spaccer" class="visible-xs"></div>
          <div id="license-wrapper" class="col-xs-12 col-sm-4">
              <p class="license">

                  Phalcon7 Framework is released under the <a href="https://github.com/dreamsxin/cphalcon7/blob/master/docs/LICENSE.md">new BSD license</a>.<br>
                  Except where otherwise noted, content on this site is licensed under the
                  <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a>
              </p>
              <div class="design">
                  <span>Designed by:</span>

                  <a href="http://www.fog-city.net/" class="fogcity" target="_blank" title="Fog City Software"><span>Fog City Software</span></a>
              </div>
          </div>
      </div>
	</div>
</footer>
</body>
</html>