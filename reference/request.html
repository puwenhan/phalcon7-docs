<!DOCTYPE html>

<html lang="en">
<head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>请求环境（Request Environment） &mdash; Phalcon7 1.0.0 文档</title>
    <meta name="keywords" content="php, phalcon, phalcon7, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="../static/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../static/phalcon.css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="../static/jquery.min.js"></script>
    <link rel="shortcut icon" href="../static/img/favicon.ico"/>
    <link rel="index" title="索引" href="../index.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="top" title="Phalcon7 1.0.0 文档" href="../index.html" />
    <link rel="next" title="返回响应（Returning Responses）" href="response.html" />
    <link rel="prev" title="事件管理器（Events Manager）" href="events.html" /> 
</head>
<body>

<header class="page-header">
<nav class="navbar" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
				<span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
			</button>
			<a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
		</div>

		<div class="collapse navbar-collapse navbar-right" id="main-menu-container">
			<ul class="nav navbar-nav main-menu">
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7" class="header-nav-link">GitHub</a></li>
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7/releases" class="header-nav-link">Download</a></li>
			  <li class="first"><a href="/api/" class="header-nav-link">API</a></li>
			</ul>
		</div>
	</div>
</nav>
</header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="response.html" title="返回响应（Returning Responses）"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="events.html" title="事件管理器（Events Manager）"
             accesskey="P">上一页</a> |</li>
        <li><a href="http://myleftstudio.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon7 1.0.0 文档</a> &raquo;</li> 
      </ul>
    </div>  
</div>

<div class="container-fluid">
	<div class="col-md-3 primary-box">
		<div class="panel panel-default">
			<div class="panel-heading"><a href="../index.html">內容目录</a></div>
			<div class="panel-body"><ul>
<li><a class="reference internal" href="#">请求环境（Request Environment）</a><ul>
<li><a class="reference internal" href="#getting-values">获取请求参数（Getting Values）</a></li>
<li><a class="reference internal" href="#request-method">请求方法（Request Method）</a><ul>
<li><a class="reference internal" href="#check-method">判断请求方法（Check Method）</a></li>
<li><a class="reference internal" href="#getting-method">获取请求方法（Getting Method）</a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-the-request-from-controllers">控制器中访问请求（Accessing the Request from Controllers）</a></li>
<li><a class="reference internal" href="#uploading-files">文件上传（Uploading Files）</a></li>
<li><a class="reference internal" href="#working-with-headers">使用头信息（Working with Headers）</a></li>
</ul>
</li>
</ul>
</div>
			<div class="panel-heading">上一个主题</div>
            <div class="panel-body"><p class="topless"><a href="events.html" title="上一章">&lt; 事件管理器（Events Manager）</a></p></div>
			<div class="panel-heading">下一个主题</div>
            <div class="panel-body"><p class="topless"><a href="response.html" title="下一章">返回响应（Returning Responses） &gt;</a></p></div>
		</div>
	</div>
  <div class="col-md-9 second-box" valign="top">
	<div class="document">
		<div class="documentwrapper">
		  <div class="bodywrapper">
			<div class="body" >
			  
  <div class="section" id="request-environment">
<h1>请求环境（Request Environment）<a class="headerlink" href="#request-environment" title="永久链接至标题">¶</a></h1>
<p>每个 HTTP 请求（通常由浏览器发起），包含了请求参数、HTTP 头信息（包括Cookies）、文件等。Web 应用程序需要解析这些信息，并根据这些信息返回正确的响应给请求者。
请求对象 <a class="reference internal" href="../api/Phalcon_Http_Request.html"><span class="doc">Phalcon\Http\Request</span></a> 封装了这些信息，你可以以面向对象的方式访问它。</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Http\Request</span><span class="p">;</span>

<span class="c1">// Getting a request instance</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">();</span>

<span class="c1">// Check whether the request was made with method POST</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// Check whether the request was made with Ajax</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isAjax</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;Request was made using POST and AJAX&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="getting-values">
<h2>获取请求参数（Getting Values）<a class="headerlink" href="#getting-values" title="永久链接至标题">¶</a></h2>
<p>PHP automatically fills the superglobal arrays <code class="code docutils literal"><span class="pre">$_GET</span></code> and <code class="code docutils literal"><span class="pre">$_POST</span></code> depending on the type of the request. These arrays
contain the values present in forms submitted or the parameters sent via the URL. The variables in the arrays are
never sanitized and can contain illegal characters or even malicious code, which can lead to <a class="reference external" href="http://en.wikipedia.org/wiki/SQL_injection">SQL injection</a> or
<a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_scripting">Cross Site Scripting (XSS)</a> attacks.</p>
<p><a class="reference internal" href="../api/Phalcon_Http_Request.html"><span class="doc">Phalcon\Http\Request</span></a> allows you to access the values stored in the <code class="code docutils literal"><span class="pre">$_REQUEST</span></code>,
<code class="code docutils literal"><span class="pre">$_GET</span></code> and <code class="code docutils literal"><span class="pre">$_POST</span></code> arrays and sanitize or filter them with the &#8216;filter&#8217; service, (by default
<a class="reference internal" href="filter.html"><span class="doc">Phalcon\Filter</span></a>). The following examples offer the same behavior:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// Gets a variable from the $_REQUEST superglobal</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">);</span>

<span class="c1">// Checks whether $_REQUEST superglobal has certain index</span>
<span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">);</span>

<span class="c1">// Manually applying the filter</span>
<span class="nv">$filter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Filter</span><span class="p">();</span>
<span class="nv">$email</span>  <span class="o">=</span> <span class="nv">$filter</span><span class="o">-&gt;</span><span class="na">sanitize</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;user_email&quot;</span><span class="p">],</span> <span class="s2">&quot;email&quot;</span><span class="p">);</span>

<span class="c1">// Manually applying the filter to the value</span>
<span class="nv">$filter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Filter</span><span class="p">();</span>
<span class="nv">$email</span>  <span class="o">=</span> <span class="nv">$filter</span><span class="o">-&gt;</span><span class="na">sanitize</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;user_email&quot;</span><span class="p">),</span> <span class="s2">&quot;email&quot;</span><span class="p">);</span>

<span class="c1">// Automatically applying the filter</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;user_email&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">);</span>

<span class="c1">// Setting a default value if the param is null</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;user_email&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;some@example.com&quot;</span><span class="p">);</span>

<span class="c1">// Setting a default value if the param is null without filtering</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;user_email&quot;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s2">&quot;some@example.com&quot;</span><span class="p">);</span>

<span class="c1">// Gets a variable from put request</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPut</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">);</span>

<span class="c1">// Gets variable from $_GET superglobal</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">);</span>

<span class="c1">// Gets variable from $_SERVER superglobal</span>
<span class="nv">$host</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getServer</span><span class="p">(</span><span class="s2">&quot;HOST&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="request-method">
<h2>请求方法（Request Method）<a class="headerlink" href="#request-method" title="永久链接至标题">¶</a></h2>
<div class="section" id="check-method">
<h3>判断请求方法（Check Method）<a class="headerlink" href="#check-method" title="永久链接至标题">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// Check if HTTP method match any of the passed methods</span>
<span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isMethod</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">);</span>

<span class="c1">// Checks whether HTTP method is POST. if $_SERVER[&#39;REQUEST_METHOD&#39;]==&#39;POST&#39;</span>
<span class="nv">$ret</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-method">
<h3>获取请求方法（Getting Method）<a class="headerlink" href="#getting-method" title="永久链接至标题">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// Gets HTTP method which request has been made</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="accessing-the-request-from-controllers">
<h2>控制器中访问请求（Accessing the Request from Controllers）<a class="headerlink" href="#accessing-the-request-from-controllers" title="永久链接至标题">¶</a></h2>
<p>The most common place to access the request environment is in an action of a controller. To access the
<a class="reference internal" href="../api/Phalcon_Http_Request.html"><span class="doc">Phalcon\Http\Request</span></a> object from a controller you will need to use
the <code class="code docutils literal"><span class="pre">$this-&gt;request</span></code> public property of the controller:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">saveAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Check if request has made with POST</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">())</span> <span class="p">{</span>

            <span class="c1">// Access POST data</span>
            <span class="nv">$customerName</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>
            <span class="nv">$customerBorn</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;born&quot;</span><span class="p">);</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="uploading-files">
<h2>文件上传（Uploading Files）<a class="headerlink" href="#uploading-files" title="永久链接至标题">¶</a></h2>
<p>Another common task is file uploading. <a class="reference internal" href="../api/Phalcon_Http_Request.html"><span class="doc">Phalcon\Http\Request</span></a> offers
an object-oriented way to achieve this task:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Mvc\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">uploadAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Check if the user has uploaded files</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">hasFiles</span><span class="p">())</span> <span class="p">{</span>

            <span class="c1">// Print the real file names and sizes</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getUploadedFiles</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// Print file details</span>
                <span class="k">echo</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">(),</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getSize</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

                <span class="c1">// Move the file into the application</span>
                <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">moveTo</span><span class="p">(</span><span class="s1">&#39;files/&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each object returned by <code class="code docutils literal"><span class="pre">Phalcon\Http\Request::getUploadedFiles()</span></code> is an instance of the
<a class="reference internal" href="../api/Phalcon_Http_Request_File.html"><span class="doc">Phalcon\Http\Request\File</span></a> class. Using the <code class="code docutils literal"><span class="pre">$_FILES</span></code> superglobal
array offers the same behavior. <a class="reference internal" href="../api/Phalcon_Http_Request_File.html"><span class="doc">Phalcon\Http\Request\File</span></a> encapsulates
only the information related to each file uploaded with the request.</p>
</div>
<div class="section" id="working-with-headers">
<h2>使用头信息（Working with Headers）<a class="headerlink" href="#working-with-headers" title="永久链接至标题">¶</a></h2>
<p>As mentioned above, request headers contain useful information that allow us to send the proper response back to
the user. The following examples show usages of that information:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// Get the Http-X-Requested-With header</span>
<span class="nv">$requestedWith</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getHeader</span><span class="p">(</span><span class="s2">&quot;HTTP_X_REQUESTED_WITH&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$requestedWith</span> <span class="o">==</span> <span class="s2">&quot;XMLHttpRequest&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;The request was made with Ajax&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Same as above</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isAjax</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;The request was made with Ajax&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Check the request layer</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isSecureRequest</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;The request was made using a secure layer&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Get the servers&#39;s IP address. ie. 192.168.0.100</span>
<span class="nv">$ipAddress</span>   <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getServerAddress</span><span class="p">();</span>

<span class="c1">// Get the client&#39;s IP address ie. 201.245.53.51</span>
<span class="nv">$ipAddress</span>   <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getClientAddress</span><span class="p">();</span>

<span class="c1">// Get the User Agent (HTTP_USER_AGENT)</span>
<span class="nv">$userAgent</span>   <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getUserAgent</span><span class="p">();</span>

<span class="c1">// Get the best acceptable content by the browser. ie text/xml</span>
<span class="nv">$contentType</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getAcceptableContent</span><span class="p">();</span>

<span class="c1">// Get the best charset accepted by the browser. ie. utf-8</span>
<span class="nv">$charset</span>     <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getBestCharset</span><span class="p">();</span>

<span class="c1">// Get the best language accepted configured in the browser. ie. en-us</span>
<span class="nv">$language</span>    <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getBestLanguage</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>


			</div>
		  </div>
		</div>
	</div>
  </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="response.html" title="返回响应（Returning Responses）"
             >下一页</a> |</li>
        <li class="right" >
          <a href="events.html" title="事件管理器（Events Manager）"
             >上一页</a> |</li> 
      </ul>
    </div>

<footer class="footer">
	<div class="container">
      <div class="row">
          <div class="col-xs-6 col-sm-3">
              <h4>Download</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/releases">安裝 Phalcon7</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-3">
              <h4>Community</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7">GitHub</a></li>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/issues">Issue Tracker</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-2">
              <h4>About</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon/wiki/%E6%8D%90%E8%B5%A0%EF%BC%88Donation%EF%BC%89">Donate</a></li>
              </ul>
          </div>
          <div id="license-spaccer" class="visible-xs"></div>
          <div id="license-wrapper" class="col-xs-12 col-sm-4">
              <p class="license">

                  Phalcon7 Framework is released under the <a href="https://github.com/dreamsxin/cphalcon7/blob/master/docs/LICENSE.md">new BSD license</a>.<br>
                  Except where otherwise noted, content on this site is licensed under the
                  <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a>
              </p>
              <div class="design">
                  <span>Designed by:</span>

                  <a href="http://www.fog-city.net/" class="fogcity" target="_blank" title="Fog City Software"><span>Fog City Software</span></a>
              </div>
          </div>
      </div>
	</div>
</footer>
</body>
</html>